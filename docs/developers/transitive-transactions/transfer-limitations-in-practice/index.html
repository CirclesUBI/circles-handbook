<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.71">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Circles UBI | Handbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Circles UBI | Handbook Blog Atom Feed"><title data-react-helmet="true">The limitation of transitive transactions in practice | Circles UBI | Handbook</title><meta data-react-helmet="true" property="og:url" content="https://handbook.joincircles.net/docs/developers/transitive-transactions/transfer-limitations-in-practice"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="The limitation of transitive transactions in practice | Circles UBI | Handbook"><meta data-react-helmet="true" name="description" content="In progress"><meta data-react-helmet="true" property="og:description" content="In progress"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://handbook.joincircles.net/docs/developers/transitive-transactions/transfer-limitations-in-practice"><link data-react-helmet="true" rel="alternate" href="https://handbook.joincircles.net/docs/developers/transitive-transactions/transfer-limitations-in-practice" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://handbook.joincircles.net/docs/developers/transitive-transactions/transfer-limitations-in-practice" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de881567.css">
<link rel="preload" href="/assets/js/styles.0028ca36.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.3438ec87.js" as="script">
<link rel="preload" href="/assets/js/main.c50c9067.js" as="script">
<link rel="preload" href="/assets/js/1.bd94ab3d.js" as="script">
<link rel="preload" href="/assets/js/2.57ca8866.js" as="script">
<link rel="preload" href="/assets/js/34.9249f6e0.js" as="script">
<link rel="preload" href="/assets/js/35.0ae172ca.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.7a5764f5.js" as="script">
<link rel="preload" href="/assets/js/17896441.c18e768e.js" as="script">
<link rel="preload" href="/assets/js/4a4f2b32.7cee0afe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Circles UBI" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Circles UBI" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Circles Handbook</strong></a><a class="navbar__item navbar__link" href="/docs/users">Users</a><a class="navbar__item navbar__link" href="/docs/communities">Communities</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/developers">Developers</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/developers/whitepaper">Whitepaper</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Circles UBI" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Circles UBI" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Circles Handbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/users">Users</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/communities">Communities</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/developers">Developers</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/developers/whitepaper">Whitepaper</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/developers">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/developers/whitepaper">Whitepaper</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API Reference</a><ul class="menu__list"><li class="menu__list-item"><a href="https://circlesubi.github.io/circles-core" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">circles-core</a></li><li class="menu__list-item"><a href="https://github.com/CirclesUBI/circles-api/blob/main/API.md" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">circles-api</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Transitive transactions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/developers/transitive-transactions/transfer-limitations-in-practice">The limitation of transitive transactions in practice</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/developers/tutorials">Tutorials</a></li><li class="menu__list-item"><a href="https://joincircles.net/faq" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">FAQ</a></li><li class="menu__list-item"><a href="https://github.com/CirclesUBI/.github/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">Contributing</a></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">The limitation of transitive transactions in practice</h1></header><div class="markdown"><p><em>In progress</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transfer-steps"></a>Transfer steps<a class="hash-link" href="#transfer-steps" title="Direct link to heading">#</a></h2><p>We define the number of transfer steps as the number of transactions that need to happen to complete the transitive transaction.
What path(s) to chose for a transitive transaction is a mathematical problem that can be solved in different ways depending on what one wants to optimize for. We call the service for finding a path a pathfinder and there are already more than one available.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="our-pathfinder-used-for-circlesgarden"></a>Our pathfinder used for circles.garden<a class="hash-link" href="#our-pathfinder-used-for-circlesgarden" title="Direct link to heading">#</a></h3><p>You can follow the first two steps in <a href="/docs/developers/tutorials/estimate-gas-cost">this tutorial</a> to find the transfer steps that <a href="https://circles.garden" target="_blank" rel="noopener noreferrer">circles.garden</a> would use for any hypothetical transaction of your choice. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="criseths-pathfinder"></a>Criseth&#x27;s pathfinder<a class="hash-link" href="#criseths-pathfinder" title="Direct link to heading">#</a></h3><p>There is another pathfinder being developed <a href="https://github.com/chriseth/pathfinder" target="_blank" rel="noopener noreferrer">here</a>.
You can use <a href="https://chriseth.github.io/pathfinder/" target="_blank" rel="noopener noreferrer">this visual interface</a> of this pathfinder to explore the circles trust network and find different transactions. This pathfinder works slightly differently from ours. The paths found in this interface are not necessarily the same that <a href="https://circles.garden" target="_blank" rel="noopener noreferrer">circles.garden</a> would use. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="an-example-of-counting-transfer-steps"></a>An example of counting transfer steps<a class="hash-link" href="#an-example-of-counting-transfer-steps" title="Direct link to heading">#</a></h3><p>Below is an example from Criseth&#x27;s pathfinder for transferring 1000 CRC between two users. We can see that this graph has 18 edges and the transaction thus requires 18 transfer steps.</p><img src="/abfb0d5c6cc05feb5b045597336a5cc8.png" alt="Screenshot show profile" style="width:75%;height:75%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gas-limitations"></a>Gas limitations<a class="hash-link" href="#gas-limitations" title="Direct link to heading">#</a></h2><p>Each transfer in a transitive transaction costs gas. Transactions made through <a href="https://circles.garden" target="_blank" rel="noopener noreferrer">circles.garden</a> are paid for by the Circles Coop in Eth. In terms of CRC a small fee in circles is added for each transaction to &quot;compensate&quot; for this.</p><p>On the Ethereum block chains all contract calls or transactions end up inside a block. A block is either accepted or rejected on the blockchain.
All transactions in a transitive transaction should end up in the same block to make sure that all or none of the transfer steps go through. The maximum gas for a block is 12.500.000. This means that the total gas cost for a transitive transaction must not exceed this.</p><p>In practice it is dangerous to get close to this limit. A transaction with a gas cost close to this limit might have to wait a very, very long time to fit into a block with other contract calls, because of how the Ethereum blockchain works. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-this-means-in-terms-of-number-of-transfer-steps"></a>What this means in terms of number of transfer steps<a class="hash-link" href="#what-this-means-in-terms-of-number-of-transfer-steps" title="Direct link to heading">#</a></h2><p>Because of the limitations to the gas costs we have to set a maximum limit to the number of transfer steps in a transaction. This limit is currently set to 52. Here we explain why.</p><p>Following the steps in <a href="/docs/developers/tutorials/estimate-gas-cost">this tutorial</a> gas costs for a number of hypothetical transactions were estimated. The results are displayed in this figure:</p><img src="/71f5bc31243bc4555747fe64bcd7114e.png" alt="Screenshot show profile" style="width:75%;height:75%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><p>Extrapolating the results suggests that 107 steps would mean a gas cost of around 12.500.000. As we don&#x27;t want to get close to the gas limit we decided (quite arbitrarily) that we don&#x27;t want to exceed half the block gas limit (6.250.000). According to the extrapolation above, we end up at 52 steps (expected to cost 6.200.000). </p><p>This limit is debateable but it is very important that we don&#x27;t get to close to the gas limit. Since all transactions go through the relayer, a transaction which has to wait will block all other circles transactions. So the more complex the transactions, the longer the wait for all other circles transactions.</p><p>It is also worth noting that the diagram above shows the gas estimate and not the actual gas, which usually ends up being about half of the actual gas cost. This gives us some extra margin too. Below are some data points for transfers of 1 CRC. The values are taken from blockscout for transactions that were actually sent.</p><img src="/b4a823439d2c3ecc3d27ead2cdf96a95.png" alt="Screenshot show profile" style="width:50%;height:50%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><p>The maximum transfer step limit is defined programmatically in the <a href="https://github.com/CirclesUBI/circles-core/blob/7ba6de02de2a197c5a8f470a3f53b623fa149e10/src/token.js#L8" target="_blank" rel="noopener noreferrer">circles-core</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-this-means-in-terms-of-maximum-transfer-amount"></a>What this means in terms of maximum transfer amount<a class="hash-link" href="#what-this-means-in-terms-of-maximum-transfer-amount" title="Direct link to heading">#</a></h2><p>When making a transfer in the <a href="https://circles.garden" target="_blank" rel="noopener noreferrer">circles.garden</a> wallet you will get an indication of the maximum transferable amount. This number is the theoretical maximum that you can transitively transfer. It is the amount that the safes along the way will accept in terms of trusted tokens, without worrying about the number of transfer steps along the way. However, now we know there is in practice a limit to the number of transfer steps in a single transfer and that we have defined the maximum transfer steps to 52 in our code. </p><p>When transferring to a friend or a friend&#x27;s friend this maximum limit is probably quite accurate because we probably won&#x27;t need more than 52 steps. But what happens if the account we transfer to is a bit further away in the trust network? </p><p>As an example we will use two accounts that are 7 trust steps away from each other - as displayed in the following graph. Please note that it is generally unusual to find accounts that are so far away from eacother.</p><img src="/1513b87df7cd8d5644511d0cf105ab47.png" alt="Screenshot show profile" style="width:75%;height:75%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><p>The diagram below shows the number of steps needed for different amounts of CRC between the two example accounts, as calculated by the <a href="https://github.com/CirclesUBI/circles-api" target="_blank" rel="noopener noreferrer">circles api</a> (version 1.3.8).</p><img src="/aefb6bf6431d8d0dc042cba3b3df2096.png" alt="Screenshot show profile" style="width:75%;height:75%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><p>In practice, the maximum transferrable amount in a single transaction is less than 200 CRC and about one tenth of the theoretical maximum. The theoretical maximum requires around 150 steps. Also note that the number of steps increases rapidly in the begining and the number of CRC transferred is displayed logarithmically for this reason.</p><p>However, it doesn&#x27;t have to be this bad. In this transfer graph you can see the different transfer steps for transferring the theoretical maximum (1700 CRC) between the two users, according to Chriseth&#x27;s pathfinder (around 40 steps):</p><img src="/e5017a395091ae87312878a4e892d5fc.png" alt="Screenshot show profile" style="width:75%;height:75%;padding:1.2rem;display:block;margin-left:auto;margin-right:auto"><p>In conclusion, a user might not be able to make a single transfer as large as the theoretical maximum suggested by the circles.garden UI. However if we would improve the pathfind this would be far less likely to happen. It would perhaps also make sense to display the practical limit per (52 step) transaction instead of the theoretical maximum. (Currently the user is told that the transaction failed due to too many hops and that they should ask the recipient to trust them directly.)</p><p>We can also conclude that a steps limit of 52 can take us a long way in terms of large transfers to remote accounts, when using an efficient pathfinder.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/CirclesUBI/circles-handbook/edit/main/docs/developers/transitive-transactions/transfer-limitations-in-practice.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/developers/whitepaper"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Whitepaper</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/developers/tutorials"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tutorials Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#transfer-steps" class="table-of-contents__link">Transfer steps</a><ul><li><a href="#our-pathfinder-used-for-circlesgarden" class="table-of-contents__link">Our pathfinder used for circles.garden</a></li><li><a href="#criseths-pathfinder" class="table-of-contents__link">Criseth&#39;s pathfinder</a></li><li><a href="#an-example-of-counting-transfer-steps" class="table-of-contents__link">An example of counting transfer steps</a></li></ul></li><li><a href="#gas-limitations" class="table-of-contents__link">Gas limitations</a></li><li><a href="#what-this-means-in-terms-of-number-of-transfer-steps" class="table-of-contents__link">What this means in terms of number of transfer steps</a></li><li><a href="#what-this-means-in-terms-of-maximum-transfer-amount" class="table-of-contents__link">What this means in terms of maximum transfer amount</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Handbook</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/users">Users</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/communities">Communities</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/developers">Developers</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/developers/whitepaper">Whitepaper</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://chat.joincircles.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat</a></li><li class="footer__item"><a href="https://aboutcircles.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://twitter.com/CirclesUBI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/CirclesUBI" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://joincircles.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://circles.garden" target="_blank" rel="noopener noreferrer" class="footer__link-item">Circles Wallet</a></li><li class="footer__item"><a href="https://github.com/CirclesUBI/.github/blob/main/CODE_OF_CONDUCT.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code of Conduct</a></li><li class="footer__item"><a href="https://github.com/CirclesUBI/.github/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contribute</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Creative Commons Attribution Share Alike 4.0 International</div></div></div></footer></div>
<script src="/assets/js/styles.0028ca36.js"></script>
<script src="/assets/js/runtime~main.3438ec87.js"></script>
<script src="/assets/js/main.c50c9067.js"></script>
<script src="/assets/js/1.bd94ab3d.js"></script>
<script src="/assets/js/2.57ca8866.js"></script>
<script src="/assets/js/34.9249f6e0.js"></script>
<script src="/assets/js/35.0ae172ca.js"></script>
<script src="/assets/js/935f2afb.7a5764f5.js"></script>
<script src="/assets/js/17896441.c18e768e.js"></script>
<script src="/assets/js/4a4f2b32.7cee0afe.js"></script>
</body>
</html>